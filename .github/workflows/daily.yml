name: Stock News Bot

on:
  schedule:
    # åŒ—äº¬æ—¶é—´ 08:30 (å³ UTC 0:30)
    - cron: '30 0 * * 1-5'
  workflow_dispatch:

permissions:
  contents: write  # âš ï¸ å¿…é¡»å¼€å¯å†™å…¥æƒé™ï¼Œå¦åˆ™æ— æ³•ä¿å­˜é€‰è‚¡ç»“æœ

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
          
      - name: Install Dependencies
        run: pip install requests openai
        
      # 1. è¿è¡Œæ—©æŠ¥ (ä¸å½±å“é€‰è‚¡)
      - name: Run Daily News
        env:
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: python main.py daily

      # 2. è¿è¡Œ AI é€‰è‚¡ (Recommend Mode)
      - name: Run AI Recommendation
        env:
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: python main.py recommend

      # 3. ğŸ’¾ å°†é€‰è‚¡è®°å¿†æ–‡ä»¶(stock_pick.json) æäº¤å›ä»“åº“
      # è¿™æ ·åç»­çš„ç›˜ä¸­è„šæœ¬æ‰èƒ½è¯»å–åˆ°ä»Šå¤©é€‰äº†è°
      - name: Commit & Push Memory
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          # å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼ˆè¯´æ˜é€‰è‚¡æˆåŠŸï¼‰ï¼Œåˆ™æäº¤
          if [ -f stock_pick.json ]; then
            git add stock_pick.json
            git commit -m "Update Daily Stock Pick [skip ci]" || echo "No changes"
            git push
          fi
